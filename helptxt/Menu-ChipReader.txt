
[TOC]

# ChipReader

CrossMgr can accept real-time messages from a [JChip](http://mts.greentag.to/english/index.html) receiver.
CrossMgr can also import a file that was generated from a JChip system.

JChip (like all chip systems) logs the time and code when it reads a chip, and each chip has a 6 character unique code.  In order to make sense, the code must to be associated with a rider's name, team, bib, etc.
CrossMgr allows you to configure which tag goes with which rider through the external Excel sheet.  CrossMgr supports two columns, Tag and optionally Tag2, that contain the chip tag code(s) for that rider.  CrossMgr supports two tags in case you wish to give one two tags - the one intended for a backup bike.

When a rider's chip is read, the chip receiver sends a timestamped message to CrossMgr with the tag.  CrossMgr does a lookup on the tag to find which rider it was, and then uses the time to automatically make an entry - just as would be done manually.

CrossMgr always uses the chip reader's time.  This ensures accuracy even if CrossMgr gets busy and cannot look at its incoming messages for a few seconds.

CrossMgr works with a single JChip receiver - multiple readers at other locations are not supported.

Notes about the JChip reader:

1. All reads before the start of the race are ignored.
1. Reads after the start of the race, but before the Start Offset of a category will be registered, but ignored in the results.
1. A race can be started by the first tag read.  See [Actions][] for more details.

## JChip Setup
Open the JChip Setup Dialog.

### JChip Setup Dialog
Used to configure and test the JChip receiver.  Make sure you have your [JChip Documentation](http://mts.greentag.to/ControlPanelSoftManual.pdf) ready if you are configuring JChip for the first time.

CrossMgr communicates with JChip through a TCP/IP interface (that is, an internet connection).  This can be done with cable or wireless.  Check what hardware you need to accomplish this.

CrossMgr is the "server", and JChip is the "client".  The communication works as follows:

1. CrossMgr opens a socket on its computer and listens to port 53135.
1. The JChip receiver, configured as a "TCP Client", tries to connect to CrossMgr every 5 seconds.  You have to configure it so it knows how to connect to CrossMgr (see below).
1. When the JChip connection succeeds, the two systems are "connected", and start exchanging data.
1. If the CrossMgr/JChip connection is broken for any reason, the two systems will automatically reconnect when the connection is restored as JChip will try to reconnect automatically.

The JChip Setup Dialog provides the needed parameters to allow you to configure JChip.  Go to the "7 Setting of Connections" section in the JChip "Control Panel Soft Manual" and configure a JChip connection as follows:

Field|Value|Description
:----|:----|:----------
Type|TCP Client|Tells JChip to act like a client to talk to CrossMgr's server
Remote IP Address|Specified in CrossMgr|Internet address of the CrossMgr computer.
Remote Port|53135|Port on the CrossMgr computer that JChip connects to.

The Remote IP Address will be the one shown in CrossMgr.  Don't worry about the other JChip fields, however, the CrossMgr connection must be checked for "Use".
You may have to power down/power up JChip after making this change.

After configuring JChip, it is time to test it.  Press the "Start JChip Test" button in CrossMgr.  This starts the CrossMgr JChip server.

You will receive a warning if you do not have an Excel sheet configured.
If you just want to test the receiver, you don't need to worry about the warning.  If you are trying to use JChip during a race, you will need a properly configured Excel sheet to associate the tags to the rider information.

Now, turn on the JChip receiver.  In the CrossMgr Messages section, you should soon see the connection succeed.  If not, check that you have the correct "Remote IP Address" and "Remote Port".  Also check if Windows asks you if it is OK for CrossMgr to open a port for listening (don't worry - it's OK).

Now, walk across the JChip mat with some chips.  You should see the connection and tag information showing up in the "Messages" section.  Something like this:

> listening for JChip connection...
> *******************************************
> connected: JChip receiver
> waiting: for JChip receiver to respond
> receiver name: JCHIP-TEST12
> transmitting: GT command to JChip receiver (gettime)
> getTime: 013005032=14:00:50.32
> timeAdjustment: JChip time will be adjusted by 0:00:00.02 to match computer
> transmitting: S0000 command to JChip receiver (start transmission)
> 1: tag=413A74, time=2012-07-24 14:00:50.3510, Bib=not found
> 2: tag=413A3B, time=2012-07-24 14:00:50.3510, Bib=not found
> ...

You can see some of the nuts-and-bolts of the communication between the two systems.
When finished testing, press the "Stop JChip Test" button or close the dialog.

It is recommended that you test the JChip receiver connection before every race.

#### Accept JChip Data During Race
Sets the "JChip Integration" property (see [Properties][]).

When the race starts, CrossMgr will start its server, wait for a JChip connection and start recording JChip entries.  Of course, manual input still works as usual in CrossMgr while the JChip integration is running.

## Import JChip Formatted File...
Imports a JChip-formatted input file.

### JChip Data File
The JChip formatted data file to import.

### Data Policy
CrossMgr supports two policies regarding existing race data:

1. Clear All Existing Data Before Import
1. Merge New Data with Existing

The first option will clear all timing data from the race and import it again fresh from the import file.

The second option will keep all existing data in the race and merge the data from the import with it.  This is useful, for example, if you start a time trial manually, then import data into it at a later time from a chip reader.

### JChip Data Times Are (Behind/Ahead)
The HH:MM:SS.SSSS time the JChip clock was ahead of or behind the computer's clock when the data was captured by the JChip receiver.  This adjust will be applied to each time to correct it to be consistent with the computer's time.

For example, say you started a time trial manually in one location and want to import data later from the chip reader which has been set up at the time trial finish.  After checking, you see that the JChip receiver was running 4.2 seconds behind your computer's time.

To import the times accurately relative to the earlier manually entered times, you would enter a "Behind 00:00:04.2" seconds adjustment.

If you have access to the JChip receiver and its time has not been adjusted, you can set this field automatically.

To do so, open the "Menu/JChip Setup..." dialog and run a JChip test including connecting to the JChip receiver.  After the connection has been established, close the "JChip Setup..." dialog.  Althogh the dialog is closed, the time adjustment has been determined from JChip.

Now, return to the JChip Import.  You will see the time correction automatically filled in based on the last JChip connection.

### Race Start Time (if NOT first recorded time)

If you are importing into a new race, this option gives you the ability to start the race at the time specified, then import the timing data contained in the file.

Do not use this option if you are merging with existing data, as the race must already been started for existing data to be present.

## Import Orion Formatted File...
Imports an Orion-formatted input file.
See above for options.
